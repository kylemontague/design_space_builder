<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar Chart Design Space Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(to bottom right, #f8fafc, #e2e8f0);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #1e293b;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        
        .header h1:hover {
            background: #f8fafc;
        }
        
        .header input, .header textarea {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #3b82f6;
            border-radius: 0.5rem;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .header textarea {
            font-size: 1rem;
            font-weight: normal;
            resize: vertical;
        }
        
        .description {
            color: #64748b;
            margin-top: 0.5rem;
        }
        
        .tabs {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            overflow-x: auto;
        }
        
        .tab-button {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            color: #64748b;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }
        
        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        .tab-button:hover {
            color: #1e293b;
        }
        
        .tab-content {
            padding: 1.5rem;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
        
        .card {
            background: #f8fafc;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .dimension-card, .datapoint-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .dimension-header, .datapoint-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }
        
        .dimension-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-icon {
            padding: 0.5rem;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 0.25rem;
        }
        
        .btn-icon:hover {
            background: #f1f5f9;
        }
        
        .btn-icon.danger:hover {
            background: #fee2e2;
            color: #dc2626;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: #475569;
        }
        
        .level-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.25rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .level-header {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .flex-1 {
            flex: 1;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #94a3b8;
        }
        
        .color-scheme {
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .color-scheme.active {
            border-color: #3b82f6;
        }
        
        .color-scheme:hover {
            border-color: #60a5fa;
        }
        
        .color-swatches {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }
        
        .color-swatch {
            width: 2rem;
            height: 2rem;
            border-radius: 0.25rem;
        }
        
        .grid {
            display: grid;
            gap: 1rem;
        }
        
        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .checkbox-label input {
            width: auto;
            margin: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th, td {
            border: 1px solid #cbd5e1;
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: #f1f5f9;
            font-weight: 600;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .legend-swatch {
            width: 20px;
            height: 20px;
            border: 2px solid;
            border-radius: 0.25rem;
        }
        
        .datapoint-preview {
            position: relative;
            display: inline-block;
        }
        
        .datapoint-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #64748b;
            color: white;
            font-size: 0.625rem;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
        }
        
        .hidden-item {
            opacity: 0.5;
        }
        
        .size-presets {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .info-box {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        #chartPreview, #chartView, #chartExport {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }
        
        svg {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div id="headerDisplay">
                <h1 id="titleDisplay" onclick="editTitle()">Design Space</h1>
                <p class="description" id="descDisplay"></p>
                <p style="font-size: 0.75rem; color: #94a3b8; margin-top: 0.5rem;">Click to edit</p>
            </div>
            <div id="headerEdit" style="display: none;">
                <input type="text" id="titleInput" value="Design Space">
                <textarea id="descInput" rows="2" placeholder="Design space description (optional)"></textarea>
                <button class="btn btn-primary" onclick="saveTitle()">Done</button>
            </div>
        </div>

        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('dimensions')">Configure Dimensions</button>
                <button class="tab-button" onclick="switchTab('datapoints')">Add Data Points</button>
                <button class="tab-button" onclick="switchTab('theme')">Theme & Display</button>
                <button class="tab-button" onclick="switchTab('documentation')">Documentation</button>
                <button class="tab-button" onclick="switchTab('view')">View Chart</button>
                <button class="tab-button" onclick="switchTab('export')">Import/Export</button>
            </div>

            <div class="tab-content">
                <!-- Dimensions Tab -->
                <div id="dimensions" class="tab-panel active">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2>Dimensions</h2>
                        <button class="btn btn-success" onclick="addDimension()">+ Add Dimension</button>
                    </div>
                    <div id="dimensionsList"></div>
                </div>

                <!-- Data Points Tab -->
                <div id="datapoints" class="tab-panel">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <h2>Data Points</h2>
                            <p style="font-size: 0.875rem; color: #64748b;" id="visibilityCount">0 of 0 visible</p>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-success" onclick="showAllDataPoints()">Show All</button>
                            <button class="btn btn-secondary" onclick="hideAllDataPoints()">Hide All</button>
                            <button class="btn btn-primary" onclick="addDataPoint()">+ Add Data Point</button>
                        </div>
                    </div>
                    <div id="datapointsList"></div>
                </div>

                <!-- Theme Tab -->
                <div id="theme" class="tab-panel">
                    <h2>Chart Size</h2>
                    <div class="grid grid-2" style="margin-bottom: 1rem;">
                        <div>
                            <label>Width (px)</label>
                            <input type="number" id="chartWidth" min="400" max="1600" step="50" value="800" onchange="saveState(); renderPreview()">
                        </div>
                        <div>
                            <label>Height (px)</label>
                            <input type="number" id="chartHeight" min="400" max="1600" step="50" value="800" onchange="saveState(); renderPreview()">
                        </div>
                    </div>
                    <div class="size-presets">
                        <button class="btn btn-secondary" onclick="setSize(800, 800)">Square (800√ó800)</button>
                        <button class="btn btn-secondary" onclick="setSize(1000, 800)">Landscape (1000√ó800)</button>
                        <button class="btn btn-secondary" onclick="setSize(800, 1000)">Portrait (800√ó1000)</button>
                    </div>

                    <h2 style="margin-top: 2rem;">Color Scheme</h2>
                    <div class="grid grid-3" id="colorSchemes"></div>

                    <h2 style="margin-top: 2rem;">Label Visibility</h2>
                    <label class="checkbox-label">
                        <input type="checkbox" id="showLevelLabels" checked onchange="saveState(); renderPreview()">
                        <span>Show Level Labels</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="showDimensionNames" checked onchange="saveState(); renderPreview()">
                        <span>Show Dimension Names</span>
                    </label>

                    <h2 style="margin-top: 2rem;">Preview (50% scale)</h2>
                    <div id="chartPreview"></div>
                </div>

                <!-- Documentation Tab -->
                <div id="documentation" class="tab-panel">
                    <div id="documentationContent"></div>
                </div>

                <!-- View Chart Tab -->
                <div id="view" class="tab-panel">
                    <div id="chartView"></div>
                    <div id="chartLegend" class="legend"></div>
                    
                    <div class="grid grid-2" style="margin-top: 2rem;">
                        <div class="card">
                            <h3 style="margin-bottom: 0.5rem;">Alt Text</h3>
                            <button class="btn btn-primary" onclick="generateAltText()">Generate</button>
                            <div id="altTextDisplay" style="margin-top: 1rem; display: none;">
                                <p style="font-size: 0.875rem; color: #475569;" id="altText"></p>
                                <button class="btn btn-success" onclick="copyText('altText')" style="margin-top: 0.5rem;">Copy</button>
                            </div>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 0.5rem;">Caption</h3>
                            <button class="btn btn-primary" onclick="generateCaption()">Generate</button>
                            <div id="captionDisplay" style="margin-top: 1rem; display: none;">
                                <p style="font-size: 0.875rem; color: #475569;" id="caption"></p>
                                <button class="btn btn-success" onclick="copyText('caption')" style="margin-top: 0.5rem;">Copy</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Import/Export Tab -->
                <div id="export" class="tab-panel">
                    <div class="card">
                        <h3 style="margin-bottom: 1rem;">Configuration (JSON)</h3>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="exportJSON()">Export Configuration</button>
                            <button class="btn btn-success" onclick="document.getElementById('importFile').click()">Import Configuration</button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importJSON(event)">
                        </div>
                    </div>

                    <div class="card" style="margin-top: 1rem;">
                        <h3 style="margin-bottom: 1rem;">Chart Image (SVG)</h3>
                        <p style="font-size: 0.875rem; color: #64748b; margin-bottom: 1rem;">
                            Preview of the chart that will be exported.
                        </p>
                        <div id="chartExport"></div>
                        <button class="btn btn-primary" onclick="exportSVG()" style="margin-top: 1rem;">Export as SVG</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let state = {
            chartTitle: 'Design Space',
            description: '',
            dimensions: [],
            dataPoints: [],
            theme: {
                width: 800,
                height: 800,
                showLevelLabels: true,
                showDimensionNames: true,
                colorScheme: 'default'
            }
        };

        const colorSchemes = {
            default: ['#8884d8', '#82ca9d', '#ffc658', '#ff7c7c', '#8dd1e1', '#d084d0', '#a4de6c'],
            colorblind: ['#0173B2', '#DE8F05', '#029E73', '#CC78BC', '#CA9161', '#949494', '#ECE133'],
            monochrome: ['#1a1a1a', '#404040', '#666666', '#8c8c8c', '#b3b3b3', '#d9d9d9', '#f2f2f2'],
            warm: ['#D95F02', '#E7298A', '#E6AB02', '#A6761D', '#FF6B6B', '#FFA07A', '#FFD700'],
            cool: ['#1B9E77', '#66A61E', '#7570B3', '#6495ED', '#20B2AA', '#4682B4', '#5F9EA0']
        };

        let editingDimension = null;
        let editingDataPoint = null;

        // Initialize
        function init() {
            loadState();
            renderColorSchemes();
            render();
        }

        // State management
        function saveState() {
            localStorage.setItem('radarChartState', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('radarChartState');
            if (saved) {
                state = JSON.parse(saved);
                document.getElementById('titleInput').value = state.chartTitle;
                document.getElementById('descInput').value = state.description;
                document.getElementById('chartWidth').value = state.theme.width;
                document.getElementById('chartHeight').value = state.theme.height;
                document.getElementById('showLevelLabels').checked = state.theme.showLevelLabels;
                document.getElementById('showDimensionNames').checked = state.theme.showDimensionNames;
            }
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'theme') renderPreview();
            if (tabName === 'documentation') renderDocumentation();
            if (tabName === 'view') renderChart();
            if (tabName === 'export') renderExportPreview();
        }

        // Title editing
        function editTitle() {
            document.getElementById('headerDisplay').style.display = 'none';
            document.getElementById('headerEdit').style.display = 'block';
        }

        function saveTitle() {
            state.chartTitle = document.getElementById('titleInput').value;
            state.description = document.getElementById('descInput').value;
            document.getElementById('titleDisplay').textContent = state.chartTitle;
            document.getElementById('descDisplay').textContent = state.description;
            document.getElementById('headerDisplay').style.display = 'block';
            document.getElementById('headerEdit').style.display = 'none';
            saveState();
        }

        // Dimensions
        function addDimension() {
            const id = state.dimensions.length;
            state.dimensions.push({
                id: id,
                name: 'New Dimension',
                description: '',
                levels: [
                    { id: 0, name: 'Low', description: '' },
                    { id: 1, name: 'Medium', description: '' },
                    { id: 2, name: 'High', description: '' }
                ]
            });
            saveState();
            renderDimensions();
        }

        function editDimension(id) {
            editingDimension = id;
            renderDimensions();
        }

        function saveDimension() {
            editingDimension = null;
            saveState();
            renderDimensions();
        }

        function deleteDimension(id) {
            if (confirm('Delete this dimension?')) {
                state.dimensions = state.dimensions.filter(d => d.id !== id);
                state.dimensions.forEach((d, i) => d.id = i);
                state.dataPoints.forEach(dp => {
                    delete dp.values[id];
                });
                saveState();
                renderDimensions();
                renderDataPoints();
            }
        }

        function moveDimension(id, direction) {
            const idx = state.dimensions.findIndex(d => d.id === id);
            const newIdx = direction === 'up' ? idx - 1 : idx + 1;
            if (newIdx < 0 || newIdx >= state.dimensions.length) return;
            
            [state.dimensions[idx], state.dimensions[newIdx]] = [state.dimensions[newIdx], state.dimensions[idx]];
            saveState();
            renderDimensions();
        }

        function addLevel(dimId) {
            const dim = state.dimensions.find(d => d.id === dimId);
            dim.levels.push({ id: dim.levels.length, name: 'New Level', description: '' });
            renderDimensions();
        }

        function deleteLevel(dimId, levelId) {
            const dim = state.dimensions.find(d => d.id === dimId);
            if (dim.levels.length <= 2) return;
            dim.levels = dim.levels.filter(l => l.id !== levelId);
            dim.levels.forEach((l, i) => l.id = i);
            renderDimensions();
        }

        function renderDimensions() {
            const container = document.getElementById('dimensionsList');
            
            if (state.dimensions.length === 0) {
                container.innerHTML = '<div class="empty-state">No dimensions yet. Click "Add Dimension" to get started.</div>';
                return;
            }

            container.innerHTML = state.dimensions.map((dim, idx) => {
                if (editingDimension === dim.id) {
                    return `
                        <div class="dimension-card">
                            <h4 style="margin-bottom: 1rem;">Editing Dimension</h4>
                            <input type="text" value="${dim.name}" 
                                onchange="state.dimensions[${idx}].name = this.value">
                            <textarea rows="2" placeholder="Dimension description"
                                onchange="state.dimensions[${idx}].description = this.value">${dim.description}</textarea>
                            
                            <h5 style="margin-top: 1rem; margin-bottom: 0.5rem;">Levels</h5>
                            ${dim.levels.map((level, levelIdx) => `
                                <div class="level-item">
                                    <div class="level-header">
                                        <input type="text" class="flex-1" value="${level.name}"
                                            onchange="state.dimensions[${idx}].levels[${levelIdx}].name = this.value">
                                        ${dim.levels.length > 2 ? `
                                            <button class="btn btn-danger" onclick="deleteLevel(${dim.id}, ${level.id})">√ó</button>
                                        ` : ''}
                                    </div>
                                    <textarea rows="2" placeholder="Level description"
                                        onchange="state.dimensions[${idx}].levels[${levelIdx}].description = this.value">${level.description}</textarea>
                                </div>
                            `).join('')}
                            <button class="btn btn-success" onclick="addLevel(${dim.id})">+ Add Level</button>
                            
                            <div class="btn-group" style="margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="saveDimension()">Save</button>
                                <button class="btn btn-secondary" onclick="editingDimension = null; renderDimensions()">Cancel</button>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="dimension-card">
                        <div class="dimension-header">
                            <div>
                                <div class="dimension-title">${dim.name}</div>
                                ${dim.description ? `<p style="font-size: 0.875rem; color: #64748b; margin-top: 0.25rem;">${dim.description}</p>` : ''}
                                <p style="font-size: 0.875rem; color: #94a3b8; margin-top: 0.25rem;">${dim.levels.length} levels</p>
                            </div>
                            <div class="btn-group">
                                <button class="btn-icon" onclick="moveDimension(${dim.id}, 'up')" ${idx === 0 ? 'disabled' : ''}>‚Üë</button>
                                <button class="btn-icon" onclick="moveDimension(${dim.id}, 'down')" ${idx === state.dimensions.length - 1 ? 'disabled' : ''}>‚Üì</button>
                                <button class="btn-icon" onclick="editDimension(${dim.id})">‚úé</button>
                                <button class="btn-icon danger" onclick="deleteDimension(${dim.id})">√ó</button>
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            ${dim.levels.map(level => `
                                <div style="font-size: 0.875rem; margin-bottom: 0.25rem;">
                                    <strong>${level.name}</strong>${level.description ? ` - ${level.description}` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Data Points
        function addDataPoint() {
            if (state.dimensions.length === 0) {
                alert('Please add dimensions first.');
                return;
            }

            const id = state.dataPoints.length;
            const values = {};
            state.dimensions.forEach(dim => values[dim.id] = 0);
            
            state.dataPoints.push({
                id: id,
                name: `Data Point ${id + 1}`,
                visible: true,
                values: values
            });
            saveState();
            renderDataPoints();
        }

        function editDataPoint(id) {
            editingDataPoint = id;
            renderDataPoints();
        }

        function saveDataPoint() {
            editingDataPoint = null;
            saveState();
            renderDataPoints();
        }

        function deleteDataPoint(id) {
            if (confirm('Delete this data point?')) {
                state.dataPoints = state.dataPoints.filter(dp => dp.id !== id);
                state.dataPoints.forEach((dp, i) => dp.id = i);
                saveState();
                renderDataPoints();
            }
        }

        function toggleVisibility(id) {
            const dp = state.dataPoints.find(d => d.id === id);
            dp.visible = !dp.visible;
            saveState();
            renderDataPoints();
        }

        function showAllDataPoints() {
            state.dataPoints.forEach(dp => dp.visible = true);
            saveState();
            renderDataPoints();
        }

        function hideAllDataPoints() {
            state.dataPoints.forEach(dp => dp.visible = false);
            saveState();
            renderDataPoints();
        }

        function renderDataPoints() {
            const visibleCount = state.dataPoints.filter(dp => dp.visible).length;
            document.getElementById('visibilityCount').textContent = `${visibleCount} of ${state.dataPoints.length} visible`;

            const container = document.getElementById('datapointsList');
            
            if (state.dataPoints.length === 0) {
                container.innerHTML = state.dimensions.length === 0 
                    ? '<div class="empty-state">Add dimensions first before creating data points.</div>'
                    : '<div class="empty-state">No data points yet. Click "Add Data Point" to create one.</div>';
                return;
            }

            container.innerHTML = state.dataPoints.map((dp, idx) => {
                const color = colorSchemes[state.theme.colorScheme][idx % colorSchemes[state.theme.colorScheme].length];
                
                if (editingDataPoint === dp.id) {
                    return `
                        <div class="datapoint-card">
                            <input type="text" value="${dp.name}" 
                                onchange="state.dataPoints[${idx}].name = this.value">
                            
                            ${state.dimensions.map(dim => `
                                <div style="margin-top: 1rem;">
                                    <label>${dim.name}</label>
                                    <select onchange="state.dataPoints[${idx}].values[${dim.id}] = parseInt(this.value)">
                                        ${dim.levels.map(level => `
                                            <option value="${level.id}" ${dp.values[dim.id] === level.id ? 'selected' : ''}>
                                                ${level.name}
                                            </option>
                                        `).join('')}
                                    </select>
                                </div>
                            `).join('')}
                            
                            <div class="btn-group" style="margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="saveDataPoint()">Save</button>
                                <button class="btn btn-secondary" onclick="editingDataPoint = null; renderDataPoints()">Cancel</button>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="datapoint-card ${!dp.visible ? 'hidden-item' : ''}">
                        <div class="dimension-header">
                            <div style="display: flex; align-items: start; gap: 1rem;">
                                <div class="datapoint-preview">
                                    <div style="width: 2rem; height: 2rem; border: 2px solid ${color}; background: ${color}; opacity: 0.5; border-radius: 0.25rem;"></div>
                                    ${!dp.visible ? '<span class="datapoint-badge">Hidden</span>' : ''}
                                </div>
                                <div>
                                    <div class="dimension-title">${dp.name}</div>
                                    <div style="font-size: 0.875rem; color: #64748b; margin-top: 0.5rem;">
                                        ${state.dimensions.map(dim => {
                                            const level = dim.levels[dp.values[dim.id] || 0];
                                            return `<div><strong>${dim.name}:</strong> ${level.name}</div>`;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                            <div class="btn-group">
                                <button class="btn-icon" onclick="toggleVisibility(${dp.id})">${dp.visible ? 'üëÅ' : 'üëÅ‚Äçüó®'}</button>
                                <button class="btn-icon" onclick="editDataPoint(${dp.id})">‚úé</button>
                                <button class="btn-icon danger" onclick="deleteDataPoint(${dp.id})">√ó</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Theme
        function renderColorSchemes() {
            const container = document.getElementById('colorSchemes');
            container.innerHTML = Object.entries(colorSchemes).map(([key, colors]) => `
                <div class="color-scheme ${state.theme.colorScheme === key ? 'active' : ''}" 
                     onclick="state.theme.colorScheme = '${key}'; saveState(); renderColorSchemes(); renderPreview();">
                    <div style="font-weight: 500; text-transform: capitalize;">${key}</div>
                    <div class="color-swatches">
                        ${colors.map(color => `<div class="color-swatch" style="background: ${color};"></div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function setSize(width, height) {
            state.theme.width = width;
            state.theme.height = height;
            document.getElementById('chartWidth').value = width;
            document.getElementById('chartHeight').value = height;
            saveState();
            renderPreview();
        }

        // Chart rendering
        function renderRadarChart(container, scale = 1) {
            if (state.dimensions.length === 0) {
                container.innerHTML = '<div class="empty-state">Add dimensions to see the chart</div>';
                return null;
            }

            state.theme.width = parseInt(document.getElementById('chartWidth').value);
            state.theme.height = parseInt(document.getElementById('chartHeight').value);
            state.theme.showLevelLabels = document.getElementById('showLevelLabels').checked;
            state.theme.showDimensionNames = document.getElementById('showDimensionNames').checked;

            const width = state.theme.width * scale;
            const height = state.theme.height * scale;
            const centerX = width / 2;
            const centerY = height / 2;
            const minDim = Math.min(width, height);
            const minRadius = minDim * 0.1;
            const maxRadius = minDim * 0.31;
            const axisExtension = minDim * 0.075;

            const colors = colorSchemes[state.theme.colorScheme];
            const visibleDataPoints = state.dataPoints.filter(dp => dp.visible);

            const patterns = ['solid', 'horizontal', 'vertical', 'diagonal-right', 'diagonal-left', 'crosshatch', 'dots'];

            const getAngle = (index, total) => (index * 2 * Math.PI) / total - Math.PI / 2;
            const getPoint = (angle, distance) => ({
                x: centerX + distance * Math.cos(angle),
                y: centerY + distance * Math.sin(angle)
            });

            // Create SVG
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
            svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');

            // Define patterns
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            visibleDataPoints.forEach((dp, idx) => {
                const color = colors[idx % colors.length];
                const patternType = patterns[idx % patterns.length];
                
                if (patternType !== 'solid') {
                    const pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
                    pattern.setAttribute('id', `pattern-${dp.id}`);
                    pattern.setAttribute('patternUnits', 'userSpaceOnUse');
                    pattern.setAttribute('width', '8');
                    pattern.setAttribute('height', '8');

                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('width', '8');
                    rect.setAttribute('height', '8');
                    rect.setAttribute('fill', color);
                    rect.setAttribute('opacity', '0.3');
                    pattern.appendChild(rect);

                    if (patternType === 'horizontal') {
                        ['2', '6'].forEach(y => {
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', '0'); line.setAttribute('y1', y);
                            line.setAttribute('x2', '8'); line.setAttribute('y2', y);
                            line.setAttribute('stroke', color); line.setAttribute('stroke-width', '1');
                            pattern.appendChild(line);
                        });
                    } else if (patternType === 'vertical') {
                        ['2', '6'].forEach(x => {
                            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                            line.setAttribute('x1', x); line.setAttribute('y1', '0');
                            line.setAttribute('x2', x); line.setAttribute('y2', '8');
                            line.setAttribute('stroke', color); line.setAttribute('stroke-width', '1');
                            pattern.appendChild(line);
                        });
                    } else if (patternType === 'diagonal-right') {
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', '0'); line.setAttribute('y1', '8');
                        line.setAttribute('x2', '8'); line.setAttribute('y2', '0');
                        line.setAttribute('stroke', color); line.setAttribute('stroke-width', '1');
                        pattern.appendChild(line);
                    } else if (patternType === 'diagonal-left') {
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', '0'); line.setAttribute('y1', '0');
                        line.setAttribute('x2', '8'); line.setAttribute('y2', '8');
                        line.setAttribute('stroke', color); line.setAttribute('stroke-width', '1');
                        pattern.appendChild(line);
                    } else if (patternType === 'crosshatch') {
                        const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line1.setAttribute('x1', '0'); line1.setAttribute('y1', '0');
                        line1.setAttribute('x2', '8'); line1.setAttribute('y2', '8');
                        line1.setAttribute('stroke', color); line1.setAttribute('stroke-width', '1');
                        const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line2.setAttribute('x1', '0'); line2.setAttribute('y1', '8');
                        line2.setAttribute('x2', '8'); line2.setAttribute('y2', '0');
                        line2.setAttribute('stroke', color); line2.setAttribute('stroke-width', '1');
                        pattern.appendChild(line1); pattern.appendChild(line2);
                    } else if (patternType === 'dots') {
                        [[2, 2], [6, 6]].forEach(([cx, cy]) => {
                            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                            circle.setAttribute('cx', cx); circle.setAttribute('cy', cy);
                            circle.setAttribute('r', '1'); circle.setAttribute('fill', color);
                            pattern.appendChild(circle);
                        });
                    }

                    defs.appendChild(pattern);
                }
            });
            svg.appendChild(defs);

            // Draw axes
            state.dimensions.forEach((dim, idx) => {
                const angle = getAngle(idx, state.dimensions.length);
                const endPoint = getPoint(angle, maxRadius + axisExtension);
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', centerX); line.setAttribute('y1', centerY);
                line.setAttribute('x2', endPoint.x); line.setAttribute('y2', endPoint.y);
                line.setAttribute('stroke', '#94a3b8'); line.setAttribute('stroke-width', scale);
                svg.appendChild(line);

                // Level markers
                dim.levels.forEach((level, levelIdx) => {
                    const distance = minRadius + (levelIdx / (dim.levels.length - 1)) * (maxRadius - minRadius);
                    const point = getPoint(angle, distance);
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', point.x); circle.setAttribute('cy', point.y);
                    circle.setAttribute('r', 5 * scale);
                    circle.setAttribute('fill', 'white');
                    circle.setAttribute('stroke', '#475569');
                    circle.setAttribute('stroke-width', scale);
                    svg.appendChild(circle);

                    if (state.theme.showLevelLabels) {
                        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        text.setAttribute('x', point.x); text.setAttribute('y', point.y);
                        text.setAttribute('text-anchor', 'middle');
                        text.setAttribute('dominant-baseline', 'middle');
                        text.setAttribute('font-size', 12 * scale);
                        text.setAttribute('fill', '#1e293b');
                        text.setAttribute('stroke', 'white');
                        text.setAttribute('stroke-width', 3 * scale);
                        text.setAttribute('paint-order', 'stroke');
                        text.textContent = level.name;
                        svg.appendChild(text);
                    }
                });

                if (state.theme.showDimensionNames) {
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', endPoint.x); text.setAttribute('y', endPoint.y);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dominant-baseline', 'middle');
                    text.setAttribute('font-size', 14 * scale);
                    text.setAttribute('font-weight', '600');
                    text.setAttribute('fill', '#1e293b');
                    text.textContent = dim.name;
                    svg.appendChild(text);
                }
            });

            // Draw data points
            visibleDataPoints.forEach((dp, dpIdx) => {
                const color = colors[dpIdx % colors.length];
                const patternType = patterns[dpIdx % patterns.length];
                
                const points = state.dimensions.map((dim, idx) => {
                    const angle = getAngle(idx, state.dimensions.length);
                    const levelValue = dp.values[dim.id] || 0;
                    const distance = minRadius + (levelValue / (dim.levels.length - 1)) * (maxRadius - minRadius);
                    return getPoint(angle, distance);
                });

                const pathD = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathD);
                path.setAttribute('fill', patternType === 'solid' ? color : `url(#pattern-${dp.id})`);
                path.setAttribute('fill-opacity', patternType === 'solid' ? '0.3' : '1');
                path.setAttribute('stroke', color);
                path.setAttribute('stroke-width', 2 * scale);
                svg.appendChild(path);
            });

            container.innerHTML = '';
            container.appendChild(svg);
            return svg;
        }

        function renderPreview() {
            renderRadarChart(document.getElementById('chartPreview'), 0.5);
        }

        function renderChart() {
            const svg = renderRadarChart(document.getElementById('chartView'), 1);
            renderLegend();
        }

        function renderExportPreview() {
            renderRadarChart(document.getElementById('chartExport'), 0.5);
        }

        function renderLegend() {
            const container = document.getElementById('chartLegend');
            const visibleDataPoints = state.dataPoints.filter(dp => dp.visible);
            const colors = colorSchemes[state.theme.colorScheme];
            const patterns = ['solid', 'horizontal', 'vertical', 'diagonal-right', 'diagonal-left', 'crosshatch', 'dots'];

            if (visibleDataPoints.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = visibleDataPoints.map((dp, idx) => {
                const color = colors[idx % colors.length];
                return `
                    <div class="legend-item">
                        <div class="legend-swatch" style="background: ${color}; opacity: 0.5; border-color: ${color};"></div>
                        <span>${dp.name}</span>
                    </div>
                `;
            }).join('');
        }

        // Documentation
        function renderDocumentation() {
            const container = document.getElementById('documentationContent');
            
            if (state.dimensions.length === 0) {
                container.innerHTML = '<div class="empty-state">Add dimensions to see documentation tables.</div>';
                return;
            }

            let html = '';
            if (state.description) {
                html += `<div class="info-box">${state.description}</div>`;
            }

            html += state.dimensions.map(dim => `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div>
                            <h3>${dim.name}</h3>
                            ${dim.description ? `<p style="font-size: 0.875rem; color: #64748b; margin-top: 0.25rem;">${dim.description}</p>` : ''}
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="copyTableHTML(${dim.id})">Word</button>
                            <button class="btn btn-success" onclick="copyTableLaTeX(${dim.id})">LaTeX</button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Level Name</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${dim.levels.map(level => `
                                <tr>
                                    <td>${level.name}</td>
                                    <td>${level.description || ''}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function copyTableHTML(dimId) {
            const dim = state.dimensions.find(d => d.id === dimId);
            const html = `<h2>${dim.name}</h2>
${dim.description ? `<p>${dim.description}</p>` : ''}
<table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse; width: 100%;">
<thead>
<tr>
<th style="background-color: #f0f0f0; text-align: left; padding: 8px;">Level Name</th>
<th style="background-color: #f0f0f0; text-align: left; padding: 8px;">Description</th>
</tr>
</thead>
<tbody>
${dim.levels.map(level => `<tr>
<td style="padding: 8px;">${level.name}</td>
<td style="padding: 8px;">${level.description || ''}</td>
</tr>`).join('\n')}
</tbody>
</table>`;
            
            navigator.clipboard.writeText(html).then(() => alert('HTML table copied!'));
        }

        function copyTableLaTeX(dimId) {
            const dim = state.dimensions.find(d => d.id === dimId);
            const latex = `\\begin{table}[h]
\\centering
\\caption{${dim.name}${dim.description ? `: ${dim.description}` : ''}}
\\begin{tabular}{|l|p{10cm}|}
\\hline
\\textbf{Level Name} & \\textbf{Description} \\\\ \\hline
${dim.levels.map(level => `${level.name} & ${level.description || ''} \\\\ \\hline`).join('\n')}
\\end{tabular}
\\end{table}`;
            
            navigator.clipboard.writeText(latex).then(() => alert('LaTeX table copied!'));
        }

        // Alt text and caption
        function generateAltText() {
            const visibleDataPoints = state.dataPoints.filter(dp => dp.visible);
            const dimList = state.dimensions.map(d => d.name).join(', ');
            
            let text = `A radar chart titled "${state.chartTitle}"`;
            if (state.description) text += ` representing ${state.description}`;
            text += ` displaying ${state.dimensions.length} dimensions: ${dimList}.`;
            
            if (visibleDataPoints.length > 0) {
                text += ` The chart shows ${visibleDataPoints.length} data point${visibleDataPoints.length > 1 ? 's' : ''}: `;
                text += visibleDataPoints.map(dp => {
                    const values = state.dimensions.map(dim => {
                        const level = dim.levels[dp.values[dim.id] || 0];
                        return `${dim.name}: ${level.name}`;
                    }).join(', ');
                    return `${dp.name} (${values})`;
                }).join('; ');
                text += '.';
            }
            
            document.getElementById('altText').textContent = text;
            document.getElementById('altTextDisplay').style.display = 'block';
        }

        function generateCaption() {
            const visibleDataPoints = state.dataPoints.filter(dp => dp.visible);
            
            let text = `Figure: ${state.chartTitle}.`;
            if (state.description) text += ` ${state.description}`;
            
            text += ' This radar chart ';
            
            if (visibleDataPoints.length === 0) {
                text += 'presents the design space framework';
            } else if (visibleDataPoints.length === 1) {
                text += `presents the profile of ${visibleDataPoints[0].name}`;
            } else if (visibleDataPoints.length === 2) {
                text += `compares ${visibleDataPoints.map(dp => dp.name).join(', ')}`;
            } else {
                text += `compares ${visibleDataPoints.length} configurations (${visibleDataPoints.map(dp => dp.name).join(', ')})`;
            }
            
            text += ` across ${state.dimensions.length} dimensions.`;
            
            document.getElementById('caption').textContent = text;
            document.getElementById('captionDisplay').style.display = 'block';
        }

        function copyText(id) {
            const text = document.getElementById(id).textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = originalText, 2000);
            });
        }

        // Import/Export
        function exportJSON() {
            const config = {
                chartTitle: state.chartTitle,
                description: state.description,
                dimensions: state.dimensions,
                dataPoints: state.dataPoints,
                theme: state.theme
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${state.chartTitle.replace(/\s+/g, '_')}_config.json`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const config = JSON.parse(e.target.result);
                    state = {
                        chartTitle: config.chartTitle || 'Design Space',
                        description: config.description || '',
                        dimensions: config.dimensions || [],
                        dataPoints: config.dataPoints || [],
                        theme: config.theme || {
                            width: 800,
                            height: 800,
                            showLevelLabels: true,
                            showDimensionNames: true,
                            colorScheme: 'default'
                        }
                    };
                    
                    document.getElementById('titleInput').value = state.chartTitle;
                    document.getElementById('descInput').value = state.description;
                    document.getElementById('titleDisplay').textContent = state.chartTitle;
                    document.getElementById('descDisplay').textContent = state.description;
                    document.getElementById('chartWidth').value = state.theme.width;
                    document.getElementById('chartHeight').value = state.theme.height;
                    document.getElementById('showLevelLabels').checked = state.theme.showLevelLabels;
                    document.getElementById('showDimensionNames').checked = state.theme.showDimensionNames;
                    
                    saveState();
                    render();
                    alert('Configuration imported successfully!');
                } catch (error) {
                    alert('Failed to import configuration. Please check the file format.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function exportSVG() {
            const container = document.getElementById('chartExport');
            const svg = container.querySelector('svg');
            
            if (!svg) {
                alert('Please ensure the chart has been rendered.');
                return;
            }
            
            const svgClone = svg.cloneNode(true);
            svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
            
            const serializer = new XMLSerializer();
            const svgString = serializer.serializeToString(svgClone);
            const blob = new Blob([svgString], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${state.chartTitle.replace(/\s+/g, '_')}.svg`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }

        // Main render
        function render() {
            renderDimensions();
            renderDataPoints();
            renderColorSchemes();
        }

        // Initialize on load
        init();
    </script>
</body>
</html>